<!DOCTYPE html>
<html lang="pt-BR">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Teste Module Federation - Taskflow Shell</title>
    <style>
        body {
            font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif;
            margin: 0;
            padding: 20px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            min-height: 100vh;
        }
        .container {
            max-width: 1200px;
            margin: 0 auto;
        }
        .header {
            text-align: center;
            margin-bottom: 30px;
        }
        .test-grid {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(350px, 1fr));
            gap: 20px;
            margin-bottom: 30px;
        }
        .test-card {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            backdrop-filter: blur(10px);
            border: 1px solid rgba(255, 255, 255, 0.2);
        }
        .test-card h3 {
            margin-top: 0;
            color: #FFE066;
        }
        .status {
            padding: 8px 12px;
            border-radius: 6px;
            font-weight: bold;
            margin: 10px 0;
        }
        .status.loading { background: #3B82F6; }
        .status.success { background: #10B981; }
        .status.error { background: #EF4444; }
        .status.warning { background: #F59E0B; }
        .btn {
            background: #6366F1;
            color: white;
            border: none;
            padding: 10px 20px;
            border-radius: 8px;
            cursor: pointer;
            margin: 5px;
            transition: all 0.2s;
        }
        .btn:hover {
            background: #4F46E5;
            transform: translateY(-2px);
        }
        .log-container {
            background: rgba(0, 0, 0, 0.3);
            border-radius: 8px;
            padding: 15px;
            margin-top: 15px;
            max-height: 200px;
            overflow-y: auto;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            border: 1px solid rgba(255, 255, 255, 0.1);
        }
        .log-entry {
            margin: 2px 0;
            padding: 2px 0;
            border-bottom: 1px solid rgba(255, 255, 255, 0.05);
        }
        .log-success { color: #10B981; }
        .log-error { color: #EF4444; }
        .log-warning { color: #F59E0B; }
        .log-info { color: #3B82F6; }
        .summary {
            background: rgba(255, 255, 255, 0.1);
            border-radius: 12px;
            padding: 20px;
            text-align: center;
            margin-top: 20px;
        }
    </style>
</head>
<body>
    <div class="container">
        <div class="header">
            <h1>üîß Teste de Module Federation - Taskflow Shell</h1>
            <p>Testando corre√ß√µes para erros "p.init is not a function" e "h[p].get is not a function"</p>
        </div>

        <div class="test-grid">
            <div class="test-card">
                <h3>üì¶ Taskflow Component</h3>
                <div id="component-status" class="status loading">üîÑ Testando...</div>
                <div>
                    <strong>URL:</strong> 
                    <a href="https://taskflow-component.netlify.app/remoteEntry.js" target="_blank" style="color: #FFE066;" rel="noopener noreferrer">
                        taskflow-component.netlify.app
                    </a>
                </div>
                <button class="btn" onclick="testMFE('taskflow-component', './ProjectListComponent')">
                    üß™ Testar Carregamento
                </button>
                <div id="component-log" class="log-container"></div>
            </div>

            <div class="test-card">
                <h3>‚ö° Taskflow Reactive</h3>
                <div id="reactive-status" class="status loading">üîÑ Testando...</div>
                <div>
                    <strong>URL:</strong> 
                    <a href="https://taskflow-reactive.netlify.app/remoteEntry.js" target="_blank" style="color: #FFE066;" rel="noopener noreferrer">
                        taskflow-reactive.netlify.app
                    </a>
                </div>
                <button class="btn" onclick="testMFE('taskflow-reactive', './RealTimeCollaborationComponent')">
                    üß™ Testar Carregamento
                </button>
                <div id="reactive-log" class="log-container"></div>
            </div>

            <div class="test-card">
                <h3>üìä Taskflow Functional</h3>
                <div id="functional-status" class="status loading">üîÑ Testando...</div>
                <div>
                    <strong>URL:</strong> 
                    <a href="https://taskflow-functional.netlify.app/remoteEntry.js" target="_blank" style="color: #FFE066;" rel="noopener noreferrer">
                        taskflow-functional.netlify.app
                    </a>
                </div>
                <button class="btn" onclick="testMFE('taskflow-functional', './Module')">
                    üß™ Testar Carregamento
                </button>
                <div id="functional-log" class="log-container"></div>
            </div>
        </div>

        <div class="summary">
            <h3>üìä Resumo dos Testes</h3>
            <div id="test-summary">
                <p>Clique nos bot√µes acima para testar o carregamento dos microfrontends</p>
            </div>
            <button class="btn" onclick="testAllMFEs()">üöÄ Testar Todos</button>
            <button class="btn" onclick="clearLogs()">üßπ Limpar Logs</button>
        </div>
    </div>

    <script>
        const testResults = {
            'taskflow-component': null,
            'taskflow-reactive': null,
            'taskflow-functional': null
        };

        function log(containerId, message, type = 'info') {
            const container = document.getElementById(containerId);
            const entry = document.createElement('div');
            entry.className = `log-entry log-${type}`;
            entry.textContent = `[${new Date().toLocaleTimeString()}] ${message}`;
            container.appendChild(entry);
            container.scrollTop = container.scrollHeight;
        }

        function updateStatus(mfeName, status, message) {
            const statusEl = document.getElementById(`${mfeName.split('-')[1]}-status`);
            statusEl.className = `status ${status}`;
            statusEl.textContent = message;
            testResults[mfeName] = status;
            updateSummary();
        }

        function updateSummary() {
            const summaryEl = document.getElementById('test-summary');
            const results = Object.values(testResults);
            const success = results.filter(r => r === 'success').length;
            const error = results.filter(r => r === 'error').length;
            const loading = results.filter(r => r === 'loading').length;
            const total = Object.keys(testResults).length;

            summaryEl.innerHTML = `
                <p><strong>Resultados:</strong> ${success} ‚úÖ | ${error} ‚ùå | ${loading} üîÑ</p>
                <div style="width: 100%; background: rgba(255,255,255,0.2); border-radius: 10px; overflow: hidden; margin: 10px 0;">
                    <div style="width: ${(success/total)*100}%; background: #10B981; height: 20px; transition: width 0.3s;"></div>
                </div>
            `;
        }

        async function testMFE(remoteName, exposedModule) {
            const logId = `${remoteName.split('-')[1]}-log`;
            const remoteUrls = {
                'taskflow-component': 'https://taskflow-component.netlify.app/remoteEntry.js',
                'taskflow-reactive': 'https://taskflow-reactive.netlify.app/remoteEntry.js',
                'taskflow-functional': 'https://taskflow-functional.netlify.app/remoteEntry.js'
            };

            updateStatus(remoteName, 'loading', 'üîÑ Carregando...');
            log(logId, `Iniciando teste do ${remoteName}`, 'info');
            log(logId, `URL: ${remoteUrls[remoteName]}`, 'info');
            log(logId, `M√≥dulo: ${exposedModule}`, 'info');

            try {
                // Primeiro, testar se a URL est√° acess√≠vel
                log(logId, 'Verificando conectividade...', 'info');
                const response = await fetch(remoteUrls[remoteName], { 
                    method: 'HEAD',
                    mode: 'no-cors' // Para evitar problemas de CORS na verifica√ß√£o
                });
                
                log(logId, 'URL acess√≠vel, carregando script...', 'success');

                // Simular carregamento do m√≥dulo usando importa√ß√£o din√¢mica
                const script = document.createElement('script');
                script.src = remoteUrls[remoteName];
                script.type = 'text/javascript';
                
                const loadPromise = new Promise((resolve, reject) => {
                    script.onload = () => {
                        log(logId, 'Script carregado com sucesso', 'success');
                        
                        // Verificar se o container webpack est√° dispon√≠vel
                        if (window[remoteName]) {
                            log(logId, `Container ${remoteName} encontrado`, 'success');
                            
                            // Tentar acessar o m√©todo init
                            if (window[remoteName].init) {
                                log(logId, 'M√©todo init dispon√≠vel', 'success');
                                updateStatus(remoteName, 'success', '‚úÖ Funcionando');
                                resolve(true);
                            } else {
                                log(logId, 'M√©todo init n√£o encontrado', 'warning');
                                updateStatus(remoteName, 'warning', '‚ö†Ô∏è Init n√£o encontrado');
                                resolve(false);
                            }
                        } else {
                            log(logId, `Container ${remoteName} n√£o encontrado no window`, 'warning');
                            updateStatus(remoteName, 'warning', '‚ö†Ô∏è Container n√£o encontrado');
                            resolve(false);
                        }
                    };
                    
                    script.onerror = (error) => {
                        log(logId, `Erro ao carregar script: ${error}`, 'error');
                        updateStatus(remoteName, 'error', '‚ùå Erro de carregamento');
                        reject(error);
                    };
                });

                document.head.appendChild(script);
                await loadPromise;

            } catch (error) {
                log(logId, `Erro: ${error.message}`, 'error');
                updateStatus(remoteName, 'error', '‚ùå Falha na conex√£o');
            }
        }

        async function testAllMFEs() {
            const mfes = [
                ['taskflow-component', './ProjectListComponent'],
                ['taskflow-reactive', './RealTimeCollaborationComponent'],
                ['taskflow-functional', './Module']
            ];

            for (const [remoteName, exposedModule] of mfes) {
                await testMFE(remoteName, exposedModule);
                // Aguardar um pouco entre os testes
                await new Promise(resolve => setTimeout(resolve, 1000));
            }
        }

        function clearLogs() {
            ['component-log', 'reactive-log', 'functional-log'].forEach(id => {
                document.getElementById(id).innerHTML = '';
            });
            
            // Reset status
            Object.keys(testResults).forEach(key => {
                testResults[key] = null;
                const shortName = key.split('-')[1];
                updateStatus(key, 'loading', 'üîÑ Aguardando teste...');
            });
        }

        // Executar testes automaticamente ao carregar a p√°gina
        window.addEventListener('load', () => {
            setTimeout(testAllMFEs, 1000);
        });
    </script>
</body>
</html>
